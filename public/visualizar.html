<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VisualizaÃ§Ã£o do CurrÃ­culo</title>
  <link rel="icon" href="icon.png" type="image/png" />
  <style>
body {
  margin: 0;
  padding: 0;
  background-color: #eaeaea;
  font-family: "Segoe UI", sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#curriculo-viewer {
  position: relative;
  width: 794px;
  height: 1123px;
  overflow: hidden;
  background: white;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  margin-top: 40px;
}


.pagina {
  position: absolute;
  top: 0;
  left: 0;
  width: 794px;
  height: 1123px;
  display: none;
}

.pagina.active {
  display: block;
}

#navegacao {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: -550px;
}

#navegacao button {
  background-color: #00324a;
  color: white;
  padding: 8px 16px;
  font-size: 18px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}

#navegacao button:hover {
  background-color: #005066;
}

#curriculo {
  width: 794px;
  padding: 60px;
  box-sizing: border-box;
  background: white;
}

h1 { font-size: 32px; margin-bottom: 10px; color: #00324a; }
h2 { font-size: 20px; margin-top: 30px; color: #00324a; border-bottom: 1px solid #ccc; padding-bottom: 4px; }
ul { padding-left: 20px; margin-top: 10px; }
li { margin-bottom: 8px; }
.info-topo { display: flex; justify-content: space-between; margin-bottom: 30px; }
.foto { width: 120px; height: 160px; border-radius: 5px; object-fit: cover; border: 1px solid #ccc; }

@media (max-width: 800px) {
  #curriculo-viewer {
    transform: scale(0.4);
    transform-origin: top center;
  }

  .pagina img {
    width: 100%;
    height: auto;
  }

  #navegacao button {
    font-size: 16px;
    padding: 6px 12px;
  }
}

.info-topo p {
  margin: 0;
  padding: 0;
  font-size: 16px;
  line-height: 1.2;
}

/* BotÃµes flutuantes centralizados */
/* BotÃµes flutuantes centralizados */
.botoes-flutuantes {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  z-index: 1000;
  width: auto; /* desktop mantÃ©m auto */
}

/* Linha de botÃµes lado a lado */
.botoes-flutuantes .linha-botoes {
  display: flex;
  gap: 12px;
}

.botoes-flutuantes button {
  background-color: #00324a;
  color: white;
  padding: 8px 16px;
  font-size: 14px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.botoes-flutuantes button:hover {
  background-color: #005066;
}

/* ObservaÃ§Ã£o abaixo dos botÃµes */
.obs {
  font-size: 12px;
  color: #666;
  background: #f8f9fa;
  padding: 6px 12px;
  border-radius: 6px;
  max-width: 700px;   /* desktop mais largo */
  text-align: center;
  line-height: 1.3;
  white-space: normal;
  word-break: break-word;
}

/* Desktop: fixo no rodapÃ© */
@media (min-width: 769px) {
  .botoes-flutuantes {
    bottom: 20px;
    width: auto;
  }
}

/* Mobile: fixo mais acima, abaixo da folha */
@media (max-width: 768px) {
  .botoes-flutuantes {
    bottom: 45px;       /* sobe mais perto da folha */
    width: 100%;        /* ðŸ”‘ ocupa toda largura da tela */
    left: 0;
    transform: none;
  }
  .obs {
    font-size: 11px;
    line-height: 1.2;
    max-width: 95%;     /* ðŸ”‘ agora funciona porque o pai tem 100% */
  }
}

.marca-dagua {
  background: url("/marca.png") no-repeat center center;
  background-size: 300px;
  opacity: 0.15;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 300px;
  height: 300px;
  pointer-events: none;
  z-index: 1;
}

  </style>
</head>
<body style="position: relative; overflow-x: hidden; background: white; font-family: 'Segoe UI', sans-serif;">
  <!-- ContÃªiner das partÃ­culas -->
  <div id="particles-js" style="position: fixed; inset: 0; z-index: -1;"></div>

  <div id="curriculo-viewer">
  <div class="marca-dagua"></div>
</div>

  <div id="navegacao">
    <button id="voltar" style="display:none;">â¬…</button>
    <button id="avancar" style="display:none;">âž¡</button>
  </div>

<div class="botoes-flutuantes">
  <div class="linha-botoes">
    <button onclick="voltarParaCurriculo()">Voltar</button>
    <button onclick="redirecionarParaLoading()">Gerar PDF</button>
  </div>
  <div class="obs">
    OBS: a marca dâ€™Ã¡gua serve para nÃ£o tirar print.<br>
    O documento final serÃ¡ entregue sem ela.
  </div>
</div>

  <!-- Biblioteca de partÃ­culas -->
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>

  <!-- ConfiguraÃ§Ã£o das partÃ­culas -->
  <script>
    tsParticles.load("particles-js", {
      fullScreen: { enable: false },
      particles: {
        number: { value: 60 },
        color: { value: "#e09d00" },
        shape: { type: "circle" },
        opacity: { value: 0.3 },
        size: { value: 4 },
        move: {
          enable: true,
          speed: 1.5,
          direction: "none",
          outModes: { default: "bounce" }
        }
      },
      background: {
        color: { value: "transparent" }
      }
    });
  </script>

  <!-- Seu script original -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const dados = JSON.parse(localStorage.getItem("curriculo")) || {};
    const curriculo = document.createElement("div");
    curriculo.id = "curriculo";
curriculo.innerHTML = `
  <div class="info-topo">
    <div>
      <h1>${dados.nome || ""}</h1>
      ${dados.email ? `<p><strong>Email:</strong> ${dados.email}</p>` : ""}
      ${dados.telefone ? `<p><strong>Telefone:</strong> ${dados.telefone}</p>` : ""}
      ${dados.idade ? `<p><strong>Idade:</strong> ${dados.idade} anos</p>` : ""}
      ${(dados.endereco || dados.numero || dados.complemento || dados.bairro || dados.cidade || dados.estado || dados.cep) ? `
<p><strong>EndereÃ§o:</strong>
  ${dados.endereco || ""}${dados.numero ? `, ${dados.numero}` : ""}
  ${dados.complemento ? ` (${dados.complemento})` : ""}
  ${dados.bairro ? ` - ${dados.bairro}` : ""}${dados.cidade ? `,${dados.cidade}` : ""}
  ${dados.estado ? ` - ${dados.estado}` : ""}
  ${dados.cep ? ` | CEP: ${dados.cep}` : ""}
</p>` : ""}
      ${dados.infoAdicional ? `<p style="margin-top:6px;">${dados.infoAdicional}</p>` : ""}
    </div>
    ${dados.foto ? `<img src="${dados.foto}" class="foto" />` : ""}
  </div>
  ${dados.objetivo ? `<h2>Objetivo</h2><p>${dados.objetivo}</p>` : ""}
  ${dados.formacao ? `<h2>FormaÃ§Ã£o AcadÃªmica</h2><p>${dados.formacao}</p>` : ""}
`;

    if (Array.isArray(dados.curso)) {
      let html = "";
      for (let i = 0; i < dados.curso.length; i++) {
        const nome = dados.curso[i]?.trim();
        const inst = dados.instituicao[i]?.trim();
        let carga = dados.carga[i]?.trim();
        if (carga && /^\d+$/.test(carga)) carga += "hs";
        if (nome || inst || carga) {
          html += "<li>";
          if (nome) html += `<strong>${nome}</strong>`;
          if (inst) html += ` â€” ${inst}`;
          if (carga) html += ` <em>(${carga})</em>`;
          html += "</li>";
        }
      }
      if (html) curriculo.innerHTML += `<h2>Cursos</h2><ul>${html}</ul>`;
    }

    if (Array.isArray(dados.empresa)) {
      let html = "";
      for (let i = 0; i < dados.empresa.length; i++) {
        const empresa = dados.empresa[i]?.trim();
        const cargo = dados.cargo?.[i]?.trim();
        const inicio = dados.periodo_inicio?.[i]?.trim();
        const fim = dados.periodo_fim?.[i]?.trim();
        const atividades = dados.atividades?.[i]?.trim();
        const periodo = inicio && fim ? `${inicio} Ã  ${fim}` : inicio || fim || "";
        if (empresa || cargo || periodo || atividades) {
          html += "<li>";
          if (empresa) html += `<strong>${empresa}</strong>${periodo ? ` â€” <em>${periodo}</em>` : ""}`;
          else if (periodo) html += `<em>${periodo}</em>`;
          if (cargo) html += `<br>${cargo}`;
          if (atividades) html += `<br><span>${atividades}</span>`;
          html += "</li>";
        }
      }
      if (html) curriculo.innerHTML += `<h2>ExperiÃªncia Profissional</h2><ul>${html}</ul>`;
    }

    if (dados.habilidades) {
      curriculo.innerHTML += `<h2>Habilidades</h2><p>${dados.habilidades}</p>`;
    }
    if (dados.hobbies) {
      curriculo.innerHTML += `<h2>Hobbies</h2><p>${dados.hobbies}</p>`;
    }

    const clone = curriculo.cloneNode(true);
    clone.style.position = "absolute";
    clone.style.top = "-9999px";
    clone.style.left = "-9999px";
    clone.style.width = "794px";
    clone.style.padding = "60px";
    clone.style.background = "white";
    clone.style.boxSizing = "border-box";
    document.body.appendChild(clone);

    (async () => {
      const canvas = await html2canvas(clone, { scale: 1 });
      document.body.removeChild(clone);
      const pageHeightPx = 1123;
      const totalPages = Math.ceil(canvas.height / pageHeightPx);

      for (let i = 0; i < totalPages; i++) {
        const pageCanvas = document.createElement("canvas");
        pageCanvas.width = 794;
        pageCanvas.height = 1123;
        const ctx = pageCanvas.getContext("2d");
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, pageCanvas.width, pageCanvas.height);
        ctx.drawImage(canvas, 0, -i * pageHeightPx);
        const img = document.createElement("img");
        img.src = pageCanvas.toDataURL("image/png");
        img.style.width = "100%";
        img.style.height = "100%";
        const pagina = document.createElement("div");
        const marca = document.createElement("div");
marca.className = "marca-dagua";
pagina.appendChild(marca);

        pagina.className = "pagina";
        pagina.appendChild(img);
        document.getElementById("curriculo-viewer").appendChild(pagina);
      }

      atualizarVisualizacao();
    })();

    let paginaAtual = 0;
    function atualizarVisualizacao() {
      const paginas = document.querySelectorAll(".pagina");
      paginas.forEach((pagina, index) => {
        pagina.classList.toggle("active", index === paginaAtual);
      });

      document.getElementById("voltar").style.display = paginaAtual > 0 ? "inline-block" : "none";
      document.getElementById("avancar").style.display = paginaAtual < paginas.length - 1 ? "inline-block" : "none";
    }

    document.getElementById("voltar").addEventListener("click", () => {
      if (paginaAtual > 0) {
        paginaAtual--;
        atualizarVisualizacao();
      }
    });

    document.getElementById("avancar").addEventListener("click", () => {
      const paginas = document.querySelectorAll(".pagina");
      if (paginaAtual < paginas.length - 1) {
        paginaAtual++;
        atualizarVisualizacao();
      }
    });

    function voltarParaCurriculo() {
      window.location.href = "/curriculo";
    }

    async function redirecionarParaLoading() {
      const telefone = dados.telefone || "";

      try {
        await fetch("SEU_ENDPOINT_AQUI", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ telefone })
        });

        localStorage.setItem("curriculoParaEnviar", "true");
        localStorage.setItem("entradaViaSplash", "true");
        localStorage.setItem("navegandoInternamente", "true");

        window.removeEventListener("unload", enviarLogAbandono);
        document.removeEventListener("visibilitychange", handleVisibilityChange);

        window.location.href = "/loading";
      } catch (error) {
        console.error("Erro ao enviar telefone:", error);
        alert("Falha ao conectar com o servidor.");
      }
    }

    // ðŸ” Rastreio de abandono
    console.log("ðŸ“ Rastreamento iniciado");
    console.log("entradaViaSplash =", localStorage.getItem("entradaViaSplash"));
    console.log("navegandoInternamente =", localStorage.getItem("navegandoInternamente"));

    const inicio = Date.now();
    const nome = JSON.parse(localStorage.getItem("curriculo"))?.nome || "visitante";
    let etapaAtual = "Visualizou";
    let logEnviado = false
        let entradaViaSplash = localStorage.getItem("entradaViaSplash") === "true";
    let navegandoInternamente = localStorage.getItem("navegandoInternamente") === "true";

    document.addEventListener("click", (e) => {
      const el = e.target.closest("a");
      if (el && el.href && el.href.includes(window.location.origin)) {
        navegandoInternamente = true;
        console.log("âž¡ï¸ NavegaÃ§Ã£o interna detectada via clique");
      }
    });

    let rastreioLiberado = false;
    setTimeout(() => { rastreioLiberado = true }, 300);

    window.enviarLogAbandono = function () {
      if (logEnviado || !entradaViaSplash || navegandoInternamente) {
        console.log("â›” Log bloqueado â€” entradaViaSplash =", entradaViaSplash, "| navegandoInternamente =", navegandoInternamente);
        return;
      }

      logEnviado = true;
      const tempo = Math.round((Date.now() - inicio) / 1000);
      console.log("ðŸš¨ Disparando log de abandono apÃ³s", tempo, "segundos");

      const payload = JSON.stringify({
        acao: "etapa",
        nome,
        etapa: `Abandonou ${etapaAtual} apÃ³s ${tempo}s`,
        timestamp: new Date().toISOString()
      });

      try {
        const blob = new Blob([payload], { type: "application/json" });
        const ok = navigator.sendBeacon("https://www.officeexpress.com.br/api/logs", blob);
        if (!ok) throw new Error("sendBeacon falhou");
      } catch (err) {
        console.warn("âš ï¸ sendBeacon falhou, tentando fetch como fallback");
        fetch("https://www.officeexpress.com.br/api/logs", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: payload,
          keepalive: true
        });
      }
    };

    window.handleVisibilityChange = function () {
      console.log("ðŸ‘€ visibilitychange =", document.visibilityState);
      if (document.visibilityState === "hidden" && rastreioLiberado) {
        enviarLogAbandono();
      }
    };

    window.addEventListener("unload", () => {
      console.log("ðŸ’¥ unload disparado");
      enviarLogAbandono();
    });

    document.addEventListener("visibilitychange", handleVisibilityChange);

const codigo = sessionStorage.getItem("codigoIndicacao");
if (codigo) {
  sessionStorage.setItem("codigoIndicacao", codigo);
}

  </script>
</body>
</html>